
<%- include("includes/header") %>

<div class="container" style="margin: 4em; padding: 1em;" >

    <div class="row">
      <div class="col-lg-8 col-md-8 col-sm-12 text-center" >
            <h3>Welcome to your fav place</h3>
      </div>

        <div class="col-lg-4 col-md-4 col-sm-12" >
            <form action = '/register' method = "POST" id = "formArray">
                <div class="mb-3">
                  <label for="username" class="form-label">Username</label>
                  <input type="text" class="form-control" name = "username" id="username">
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" name="email" id="email">
                  </div>

                <div class="mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input type="password" class="form-control" name="password" id="password">
                </div>  

                <button type="submit" class="btn btn-success btn-block" name = "submit">Submit</button>
              </form>
        </div>

    </div>

</div>

<script>
   console.log('Yes');
  const form = document.querySelector('#formArray');
 
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
   
    console.log('yes2');

    const email = form.email.value;
    const password = form.password.value;
    const username = form.username.value;

    console.log('data', email, password, username);

    try {
      const res = await fetch('/register', { 
        method: 'POST', 
        body: JSON.stringify({ email, password, username }), // convert the data object to json string
        headers: {'Content-Type': 'application/json'},
        mode : 'cors',
        redirect : 'follow'
      });

      if(res.status == 200){
        const data = await res.json();

        console.log(data.errors);

        if(data.success) window.location.replace('/dashboard');
        else {console.log(data.errors); throw Error(data.errors);}
      }
      else{
        throw Error({status : res.status});
      }


    }
    catch (err) {
      console.log('there is a error in sending the data ', err);
    }
  });

</script>

<%- include("includes/footer") %>


